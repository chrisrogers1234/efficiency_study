// Step IV coil currents
//
// From MICE Note 464 v1

Module Stage4Coils
{
  PropertyString Material Galactic
  PropertyHep3Vector Dimensions 1000.0 1000.0 30000.0 mm 

  Substitution $FieldMapMode Read
  Substitution $ZOffset 16955.74

  Substitution $EC2_US_Current 205.5
  Substitution $CC_US_Current 205.5
  Substitution $EC1_US_Current 205.5
  Substitution $MC2_US_Current 208.6
  Substitution $MC1_US_Current 102.3
  Substitution $FC_US_Current 41.50
  Substitution $FC_DS_Current 41.50
  Substitution $MC1_DS_Current 0.
  Substitution $MC2_DS_Current 0.0
  Substitution $EC1_DS_Current 205.5
  Substitution $CC_DS_Current 205.5
  Substitution $EC2_DS_Current 205.5
  Substitution $AbsorberMaterial MICE_LITHIUM_HYDRIDE
  Substitution $AbsorberThickness 65.

  Substitution $SS_Offset 2450.
  Substitution $Flip +1. // +1. for solenoid; -1 for flip
  Module BeamPipe
  {
      Volume Tube
      Dimensions 257.0 300.0 6400. mm
      PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
      PropertyString Material Galactic
  }

  Module SSU
  {
    Volume Cylinder
    PropertyString Material Galactic
    PropertyHep3Vector Dimensions 256.5 3400. -1 mm
    PropertyHep3Vector Position 0.0 0.0 $ZOffset-$SS_Offset mm
    PropertyHep3Vector Rotation 0.0 0.0 0.0 degree
    Module BeamPipe
    {
        Volume Tube
        Dimensions 200.1 256.0 3399 mm
        PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
        PropertyString Material Galactic
    }
    Module SciFi
    {
        Volume Cylinder
        Dimensions 200. 1110 mm
        Position 0. 0. +10. mm
        PropertyString Material Galactic
        Module Aperture
        {
            Volume Tube
            Dimensions 150.0 200.0 1100 mm
            PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
            PropertyString Material Galactic
        }
        Module Station5
        {
            Volume Cylinder
            Dimensions 150.0 2.0 mm
            Position 0. 0. -550. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station4
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. -200. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station3
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. +100. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station2
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. +350. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station1
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. +550. mm
            PropertyString Material POLYSTYRENE
        }
    }
    Module EndCoil2_US
    {
      Volume None
      Position 0.0 0.0 -3200+$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor $EC2_US_Current
      // Field
      PropertyString FieldType       Solenoid
      PropertyString FieldMapMode    $FieldMapMode
      PropertyString FileName        logs/tmp/end2_us.fld
      PropertyDouble Current         1.
      PropertyInt    NumberOfTurns   3968
      PropertyDouble Length          110.642
      PropertyDouble Thickness       67.783
      PropertyDouble InnerRadius     258.
      PropertyString FieldName       EndCoil2_US
    }
    Module CenterCoil_US
    {
      Volume None
      Position 0.0 0.0 -2450.+$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor $CC_US_Current
      // Field
      PropertyString FieldType      Solenoid
      PropertyString FieldMapMode   $FieldMapMode
      PropertyString FileName       logs/tmp/center_us.fld
      PropertyDouble Current        1.
      PropertyInt    NumberOfTurns  15360
      PropertyDouble Length         1314.3
      PropertyDouble Thickness      22.125
      PropertyDouble InnerRadius    258.
      PropertyString FieldName      CenterCoil_US
    }
    Module EndCoil1_US
    {
      Volume None
      Position 0.0 0.0 -1700.+$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor $EC1_US_Current
      // Field
      PropertyString FieldType       Solenoid
      PropertyString FieldMapMode    $FieldMapMode
      PropertyString FileName        logs/tmp/end1_us.fld
      PropertyDouble Current         1.
      PropertyInt    NumberOfTurns   3584
      PropertyDouble Length          110.642
      PropertyDouble Thickness       60.905
      PropertyDouble InnerRadius     258.
      PropertyString FieldName       EndCoil1_US
    }
    Module MatchCoil2_US
    {
      Volume None
      Position 0.0 0.0 -1300.+$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor $MC2_US_Current
      // Field
      PropertyString FieldType         Solenoid
      PropertyString FieldMapMode      $FieldMapMode
      PropertyString FileName          logs/tmp/match2_us.fld
      PropertyDouble Current           1.
      PropertyInt    NumberOfTurns     3192
      PropertyDouble Length            199.492
      PropertyDouble Thickness         30.925
      PropertyDouble InnerRadius       258.
      PropertyString FieldName         MatchCoil2_US

    }
    Module MatchCoil1_US
    {
      Volume None
      Position 0.0 0.0 -861.0+$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor $MC1_US_Current
      //Field
      PropertyString FieldType      Solenoid
      PropertyString FieldMapMode   $FieldMapMode
      PropertyString FileName       logs/tmp/match1_us.fld
      PropertyDouble Current        1.
      PropertyInt    NumberOfTurns  4830
      PropertyDouble Length         201.268
      PropertyDouble Thickness      46.165
      PropertyDouble InnerRadius    258.
      PropertyString FieldName      MatchCoil1_US

    }
  }


  Module AFC
  {
    Volume Cylinder
    PropertyString Material Galactic
    PropertyHep3Vector Dimensions 256.5 900. -1 mm

    Position 0.0 0.0 $ZOffset mm
    Rotation 0.0 0.0 0.0 degree
    Module FocusCoil
    {
      Volume None
      Position 0.0 0.0 -202.75 mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$FC_US_Current
      // Field
      PropertyString FieldType       Solenoid
      PropertyString FieldMapMode    $FieldMapMode
      PropertyString FileName        logs/tmp/focus_us.fld
      PropertyDouble Current         1.
      PropertyInt    NumberOfTurns   11256
      PropertyDouble Length          213.3
      PropertyDouble Thickness       94.8
      PropertyDouble InnerRadius     267.
      PropertyString FieldName       FocusCoil_US
    }
    Module Absorber
    {
      Volume Cylinder
      PropertyHep3Vector Dimensions 200. $AbsorberThickness -1. mm
      PropertyString Material $AbsorberMaterial
      Position 0.0 0.0 0.0 mm
      Rotation 0.0 0.0 0.0 degree
    }
    Module FlangeD
    {
        Volume Tube
        Position 0.0 0.0 225.0 mm
        Dimensions 160.0 200.0 10 mm
        PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
    }
    Module FocusCoil
    {
      Volume None
      Position 0.0 0.0 +202.75 mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$FC_DS_Current*$Flip
      // Field
      PropertyString FieldType       Solenoid
      PropertyString FieldMapMode    $FieldMapMode
      PropertyString FileName        logs/tmp/focus_ds.fld
      PropertyDouble Current         1.
      PropertyInt    NumberOfTurns   11257 // NOTE
      PropertyDouble Length          213.3
      PropertyDouble Thickness       94.8
      PropertyDouble InnerRadius     267.
      PropertyString FieldName       FocusCoil_DS
    }
    Module BeamPipe
    {
        Volume Tube
        Dimensions 235.0 256.0 899 mm
        PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
        PropertyString Material Galactic
    }

  }


  Module SSD
  {
    Volume Cylinder
    PropertyString Material Galactic
    PropertyHep3Vector Dimensions 256.5 3400. -1 mm
    PropertyHep3Vector Position 0.0 0.0 $ZOffset+$SS_Offset mm
    PropertyHep3Vector Rotation 0.0 0.0 0.0 degree
    Module BeamPipe
    {
        Volume Tube
        Dimensions 200.0 256.0 3399 mm
        PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
        PropertyString Material Galactic
    }
    Module SciFi
    {
        Volume Cylinder
        Dimensions 200. 1110 mm
        Position 0. 0. +10. mm
        PropertyString Material Galactic
        Module Aperture
        {
            Volume Tube
            Dimensions 150.0 200.0 1100 mm
            PropertyDouble G4KinMin 1e9 MeV // kill particles < PeV!
            PropertyString Material Galactic
        }
        Module Station5
        {
            Volume Cylinder
            Dimensions 150.0 2.0 mm
            Position 0. 0. +550. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station4
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. +200. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station3
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. -100. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station2
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. -350. mm
            PropertyString Material POLYSTYRENE
        }
        Module Station1
        {
            Volume Cylinder
            Dimensions 150. 2.0 mm
            Position 0. 0. -550. mm
            PropertyString Material POLYSTYRENE
        }
    }
    Module MatchCoil1_DS
    {
      Volume None
      Position 0.0 0.0 861.0-$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$MC1_DS_Current*$Flip
      // Field
      PropertyString FieldType      Solenoid
      PropertyString FieldMapMode   $FieldMapMode
      PropertyString FileName       logs/tmp/match1_ds.fld
      PropertyDouble Current        1.
      PropertyInt    NumberOfTurns  4830
      PropertyDouble Length         201.268
      PropertyDouble Thickness      46.483
      PropertyDouble InnerRadius    258.
      PropertyString FieldName      MatchCoil1_DS
    }
    Module MatchCoil2_DS
    {
      Volume None
      Position 0.0 0.0 1300.-$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$MC2_DS_Current*$Flip
      // Field
      PropertyString FieldType         Solenoid
      PropertyString FieldMapMode      $FieldMapMode
      PropertyString FileName          logs/tmp/match2_ds.fld
      PropertyDouble Current           1.
      PropertyInt    NumberOfTurns     3192
      PropertyDouble Length            199.492
      PropertyDouble Thickness         30.608
      PropertyDouble InnerRadius       258.
      PropertyString FieldName         MatchCoil2_DS
    }
    Module EndCoil1_DS
    {
      Volume None
      Position 0.0 0.0 1700-$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$EC1_DS_Current*$Flip
      // Field
      PropertyString FieldType       Solenoid
      PropertyString FieldMapMode    $FieldMapMode
      PropertyString FileName        logs/tmp/end1_ds.fld
      PropertyDouble Current         1.
      PropertyInt    NumberOfTurns   3584
      PropertyDouble Length          110.642
      PropertyDouble Thickness       61.638
      PropertyDouble InnerRadius     258.
      PropertyString FieldName       EndCoil1_DS
    }
    Module CenterCoil_DS
    {
      Volume None
      Position 0.0 0.0 2450.-$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$CC_DS_Current*$Flip
      // Field
      PropertyString FieldType      Solenoid
      PropertyString FieldMapMode   $FieldMapMode
      PropertyString FileName       logs/tmp/center_ds.fld
      PropertyDouble Current        1.
      PropertyInt    NumberOfTurns  15352
      PropertyDouble Length         1314.3
      PropertyDouble Thickness      22.416
      PropertyDouble InnerRadius    258.
      PropertyString FieldName      CenterCoil_DS
    }
    Module EndCoil2_DS
    {
      Volume None
      Position 0.0 0.0 3200.-$SS_Offset mm
      Rotation 0.0 0.0 0.0 degree
      ScaleFactor +$EC2_DS_Current*$Flip
      // Field
      PropertyString FieldType       Solenoid
      PropertyString FieldMapMode    $FieldMapMode
      PropertyString FileName        logs/tmp/end2_ds.fld
      PropertyDouble Current         1.
      PropertyInt    NumberOfTurns   3968
      PropertyDouble Length          110.642
      PropertyDouble Thickness       68.22
      PropertyDouble InnerRadius     258.
      PropertyString FieldName      EndCoil2_DS
    }
  }
  // tracker reference planes
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-4022 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-4000.0+@RepeatNumber*100 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
    PropertyBool   RepeatModule2 True
    PropertyInt    NumberOfRepeats 70
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-2918.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-2568.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-2268.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-2018.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset-1818.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset+2918.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset+2568.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset+2268.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset+2018.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
  Module VirtualPlane
  {
    Volume None
    Position 0.0 0.0 $ZOffset+1818.5 mm
    Rotation 0.0 0.0 0.0 degree
    PropertyString SensitiveDetector Virtual
  }
}

